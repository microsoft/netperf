name: Custom Tasks

on:
  workflow_dispatch:

permissions: write-all

jobs:
  testjob:
    strategy:
      matrix:
        test: [1, 2]
    continue-on-error: ${{ matrix.test == 1 }}
    runs-on: windows-latest
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@91182cccc01eb5e619899d80e4e971d6181294a7 # v2.10.1
        with:
          egress-policy: audit

      - name: odd fail, even pass
        run: |
          if (${{ matrix.test }} -eq 1) {
            exit 1
          }
          else {
            Write-Output "Test passed"
          }
        shell: pwsh

  upload-data:
    needs: testjob
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@91182cccc01eb5e619899d80e4e971d6181294a7 # v2.10.1
        with:
          egress-policy: audit

      - name: Upload data
        run: echo "Uploading data"