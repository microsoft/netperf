name: Custom Tasks

on:
  workflow_dispatch:

permissions: write-all

jobs:
  test-job:
    runs-on: windows-latest
    steps:
      - name: Hello
        run: echo "Hello, world!"
      - name: Print OS version data
        run: |
          # Print OS version data
          powershell -command "Get-ComputerInfo"

  test-job-linux:
    runs-on: ubuntu-latest
    steps:
      - name: Hello
        run: echo "Hello, world!"
      - name: Print OS version data
        run: |
          # Print OS version data
          Get-ComputerInfo
        shell: pwsh

  Release_Branch_Requirements:
    name: Release Branch Requirements
    if: always()
    needs: [test-job]
    runs-on: ubuntu-latest
    permissions: {} # No need for any permissions.
    steps:
    - name: Decide whether the needed jobs succeeded or failed
      if: ${{ startsWith(github.ref, 'refs/heads/release/') }}
      uses: re-actors/alls-green@05ac9388f0aebcb5727afa17fcccfecd6f8ec5fe
      with:
        jobs: ${{ toJSON(needs) }}

  Non_Release_Branch_Requirements:
    name: Non Release Branch Requirements
    if: always()
    needs: [test-job, test-job-linux]
    runs-on: ubuntu-latest
    permissions: {} # No need for any permissions.
    steps:
    - name: Decide whether the needed jobs succeeded or failed
      if: ${{ !startsWith(github.ref, 'refs/heads/release/') }}
      uses: re-actors/alls-green@05ac9388f0aebcb5727afa17fcccfecd6f8ec5fe
      with:
        jobs: ${{ toJSON(needs) }}

  Complete:
    name: Complete
    if: always()
    needs: [Release_Branch_Requirements, Non_Release_Branch_Requirements]
    runs-on: ubuntu-latest
    permissions: {} # No need for any permissions.
    steps:
    - name: Decide whether the needed jobs succeeded or failed
      uses: re-actors/alls-green@05ac9388f0aebcb5727afa17fcccfecd6f8ec5fe
      with:
        jobs: ${{ toJSON(needs) }}
